MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001     list p=16f877                 ; list directive to define processor
                      00002       #include <p16f877.inc>        ; processor specific variable definitions
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ;  MPASM PIC16F877 processor include
                      00005 ; 
                      00006 ;  (c) Copyright 1999-2013 Microchip Technology, All rights reserved
                      00007 ;==========================================================================
                      00008 
                      00540         LIST
2007   3F72           00003       __CONFIG _CP_OFF & _WDT_OFF & _BODEN_ON & _PWRTE_ON & _HS_OSC & _WRT_ENABLE_ON & _CPD_OFF & _LVP_O
                            FF
                      00004 
                      00005 ;***************************************
                      00006 ; DEFINITIONS
                      00007 ;***************************************
                      00008     #define     RS      PORTD,2
                      00009         #define E       PORTD,3
                      00010 
                      00011 
                      00012 ;***************************************
                      00013 ; VARIABLES
                      00014 ;***************************************
                      00015     cblock      0x20
                      00016         ; for use purely in code
  00000020            00017         keytemp
  00000021            00018         statustemp
  00000022            00019                 Table_Counter
  00000023            00020                 com
  00000024            00021                 dat
  00000025            00022         lcd_d1
  00000026            00023         lcd_d2
  00000027            00024         COUNTH  ;for delay 0.5s routine
  00000028            00025         COUNTM
  00000029            00026         COUNTL
  0000002A            00027         op_time_save
  0000002B            00028         huns
  0000002C            00029         tens
  0000002D            00030         ones
  0000002E            00031         bignumcount
  0000002F            00032         count76
  00000030            00033         w_isr           ;i think this needs to be in all banks?
  00000031            00034         status_isr
                      00035 
                      00036         ; values generated by main machine code
  00000032            00037         op_time     ;in seconds
  00000033            00038         status1     ;where   0 = none      1 = pass
  00000034            00039         status2     ;        2 = led fail  3 = flicker fail
  00000035            00040         status3
  00000036            00041         status4
  00000037            00042         status5
  00000038            00043         status6
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000039            00044         status7
  0000003A            00045         status8
  0000003B            00046         status9
  0000003C            00047         num_def
  0000003D            00048         num_tot
                      00049 
                      00050         endc
                      00051 
                      00052 
                      00053 ;***************************************
                      00054 ; MACROS
                      00055 ;***************************************
                      00056 
                      00057 ;LCD Delay
                      00058 LCD_DELAY   macro
                      00059             movlw   0xFF
                      00060             movwf   lcd_d1
                      00061             decfsz  lcd_d1,f
                      00062             goto    $-1
                      00063             endm
                      00064 
                      00065 ; Display a msg on LCD
                      00066 Display macro   Message
                      00067                 local   loop_
                      00068                 local   end_
                      00069                 clrf    Table_Counter
                      00070                 clrw
                      00071 loop_   movf    Table_Counter,W
                      00072                 call    Message
                      00073                 xorlw   B'00000000' ;check WORK reg to see if 0 is returned
                      00074                 btfsc   STATUS,Z
                      00075                 goto    end_
                      00076                 call    WR_DATA
                      00077                 incf    Table_Counter,F
                      00078                 goto    loop_
                      00079 end_
                      00080                 endm
                      00081 
                      00082 ;move cursor one to the right
                      00083 spacebar    macro
                      00084             movlw   B'00010100'
                      00085             call    WR_INS
                      00086             endm
                      00087 
                      00088 ;Shortcuts for moving
                      00089 movlf   macro   l, f
                      00090         movlw   l
                      00091         movwf   f
                      00092         endm
                      00093 
                      00094 movff   macro   source, dest
                      00095         movf    source, W
                      00096         movwf   dest
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00097         endm
                      00098 
                      00099 ; Display a single digit number on LCD (literal or from a reg)
                      00100 writenum    macro   number
                      00101             movlw    number
                      00102             addlw   B'00110000'
                      00103             movwf   dat
                      00104             call WR_DATA
                      00105             endm
                      00106 
                      00107 writenum_reg    macro   reg
                      00108             movfw    reg
                      00109             addlw   B'00110000'
                      00110             movwf   dat
                      00111             call WR_DATA
                      00112             endm
                      00113 
                      00114 
                      00115 ;***************************************
                      00116 ; VECTORS
                      00117 ;***************************************
                      00118 
                      00119     ORG       0x000             
0000   2???           00120          goto      init         
                      00121     ORG       0x004
0004   2???           00122         goto    isr
                      00123 
                      00124 
                      00125 ;***************************************
                      00126 ; LOOK UP TABLE (MESSAGES)
                      00127 ;***************************************
0005                  00128 Standby_Msg
0005   0782           00129                 addwf   PCL,F
0006   3453 3454 3441 00130                 dt              "STANDBY", 0
       344E 3444 3442 
       3459 3400 
000E                  00131 Start_Msg
000E   0782           00132         addwf   PCL,F
000F   3449 346E 3473 00133         dt      "Inspecting . . .",0
       3470 3465 3463 
       3474 3469 346E 
       3467 3420 342E 
       3420 342E 3420 
       342E 3400 
0020                  00134 End_Msg
0020   0782           00135         addwf   PCL,F
0021   3443 346F 346D 00136         dt      "Complete",0
       3470 346C 3465 
       3474 3465 3400 
002A                  00137 Time_Msg
002A   0782           00138                 addwf   PCL,F
002B   344F 3470 3465 00139                 dt              "Operation time:",0
       3472 3461 3474 
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

       3469 346F 346E 
       3420 3474 3469 
       346D 3465 343A 
       3400 
003B                  00140 Seconds
003B   0782           00141         addwf   PCL,F
003C   3420 3473 3465 00142         dt      " seconds", 0
       3463 346F 346E 
       3464 3473 3400 
0045                  00143 Not_present
0045   0782           00144         addwf   PCL,F
0046   343A 3420 346E 00145         dt      ": not present",0
       346F 3474 3420 
       3470 3472 3465 
       3473 3465 346E 
       3474 3400 
0054                  00146 Pass
0054   0782           00147                 addwf   PCL,F
0055   343A 3420 3470 00148                 dt              ": pass",0
       3461 3473 3473 
       3400 
005C                  00149 LED_fail
005C   0782           00150                 addwf   PCL,F
005D   343A 3420 344C 00151                 dt              ": LED fail",0
       3445 3444 3420 
       3466 3461 3469 
       346C 3400 
0068                  00152 Flick_fail
0068   0782           00153                 addwf   PCL,F
0069   343A 3420 3466 00154                 dt              ": flicker fail",0
       346C 3469 3463 
       346B 3465 3472 
       3420 3466 3461 
       3469 346C 3400 
0078                  00155 Total_Msg
0078   0782           00156         addwf   PCL,F
0079   3454 346F 3474 00157         dt      "Total candles: ",0
       3461 346C 3420 
       3463 3461 346E 
       3464 346C 3465 
       3473 343A 3420 
       3400 
0089                  00158 Defective
0089   0782           00159         addwf   PCL,F
008A   3444 3465 3466 00160         dt      "Defective: ",0
       3465 3463 3474 
       3469 3476 3465 
       343A 3420 3400 
0096                  00161 None
0096   0782           00162         addwf   PCL,F
0097   3420 3420 3420 00163         dt      "      none", 0
       3420 3420 3420 
       346E 346F 346E 
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

       3465 3400 
00A2                  00164 Emergency_Msg
00A2   0782           00165         addwf   PCL,F
00A3   3445 344D 3445 00166         dt      "EMERGENCY STOP", 0
       3452 3447 3445 
       344E 3443 3459 
       3420 3453 3454 
       344F 3450 3400 
00B2                  00167 Export_Msg
00B2   0782           00168         addwf   PCL,F
00B3   3445 3478 3470 00169         dt      "Exporting . . .",0
       346F 3472 3474 
       3469 346E 3467 
       3420 342E 3420 
       342E 3420 342E 
       3400 
                      00170 
                      00171 ;***************************************
                      00172 ; MAIN PROGRAM
                      00173 ;***************************************
                      00174 
00C3                  00175 init
                      00176         movlf     b'10000000', INTCON   ;interrupts enabled
00C3   3080               M         movlw   b'10000000'
00C4   008B               M         movwf   INTCON
                      00177 
00C5   1683           00178         bsf       STATUS,RP0     ; select bank 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00C6   0185           00179         clrf      TRISA          ; All port A is output
00C7   30F2           00180         movlw     b'11110010'    ; Set required keypad inputs
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00C8   0086           00181         movwf     TRISB
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00C9   0187           00182         clrf      TRISC          ; All port C is output
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00CA   0188           00183         clrf      TRISD          ; All port D is output
                      00184 
00CB   1283           00185         bcf       STATUS,RP0     ; select bank 0
00CC   0185           00186         clrf      PORTA
00CD   0186           00187         clrf      PORTB
00CE   0187           00188         clrf      PORTC
00CF   0188           00189         clrf      PORTD
                      00190 
00D0   2???           00191         call      InitLCD    ;Initialize the LCD
                      00192         Display   Standby_Msg
  0000                    M                 local   loop_
  0000                    M                 local   end_
00D1   01A2               M                 clrf    Table_Counter
00D2   0103               M                 clrw
00D3   0822               M loop_   movf    Table_Counter,W
00D4   2???               M                 call    Standby_Msg
00D5   3A00               M                 xorlw   B'00000000' ;check WORK reg to see if 0 is returned
00D6   1903               M                 btfsc   STATUS,Z
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00D7   2???               M                 goto    end_
00D8   2???               M                 call    WR_DATA
00D9   0AA2               M                 incf    Table_Counter,F
00DA   2???               M                 goto    loop_
00DB                      M end_
                      00193 
                      00194  ;--------------------------------------------------
                      00195  ; This is standby mode. I would like to display real date and time here
                      00196  ; eventually.
                      00197 
00DB                  00198 waiting
00DB   1C86           00199         btfss           PORTB,1     ;Wait until data is available from the keypad
00DC   2???           00200          goto           $-1
                      00201 
00DD   0E06           00202          swapf          PORTB,W     ;Read PortB<7:4> into W<3:0>
00DE   390F           00203          andlw          0x0F
00DF   3A0D           00204          xorlw      0xD         ;will be all zeros if its "START:
00E0   1903           00205          btfsc      STATUS,Z    ;and Z will be high, so skip if not high
00E1   2???           00206          goto       start
                      00207 
00E2   1886           00208          btfsc          PORTB,1     ;Wait until key is released
00E3   2???           00209          goto           $-1
00E4   2???           00210          goto       waiting
                      00211 
                      00212 ;-----------------------------------------------------------
                      00213 ;       ACTUAL OPERATION (im just adding values manually now)
                      00214 
00E5                  00215 start
                      00216         ;start the timer
                      00217         movlf       D'76', count76
00E5   304C               M         movlw   D'76'
00E6   00AF               M         movwf   count76
00E7   01B2           00218         clrf        op_time
00E8   168B           00219         bsf         INTCON, T0IE ;enable Timer0 interrupt
00E9   1283 1303      00220         banksel     TMR0
00EB   0181           00221         clrf        TMR0
00EC   1683 1303      00222         banksel     OPTION_REG
                      00223         movlf       B'11000110', OPTION_REG ; 1:128 prescaler
00EE   30C6               M         movlw   B'11000110'
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00EF   0081               M         movwf   OPTION_REG
00F0   1283           00224         bcf        STATUS,RP0     ; back to bank 0
                      00225 
                      00226         ;display message
00F1   2???           00227         call        Clear_Display
                      00228         Display     Start_Msg
  0000                    M                 local   loop_
  0000                    M                 local   end_
00F2   01A2               M                 clrf    Table_Counter
00F3   0103               M                 clrw
00F4   0822               M loop_   movf    Table_Counter,W
00F5   2???               M                 call    Start_Msg
00F6   3A00               M                 xorlw   B'00000000' ;check WORK reg to see if 0 is returned
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00F7   1903               M                 btfsc   STATUS,Z
00F8   2???               M                 goto    end_
00F9   2???               M                 call    WR_DATA
00FA   0AA2               M                 incf    Table_Counter,F
00FB   2???               M                 goto    loop_
00FC                      M end_
                      00229 
                      00230         ; just delaying for now (11s delay)
00FC   2???           00231         call        HalfS
00FD   2???           00232         call        HalfS
00FE   2???           00233         call        HalfS
00FF   2???           00234         call        HalfS
0100   2???           00235         call        HalfS
0101   2???           00236         call        HalfS
0102   2???           00237         call        HalfS
0103   2???           00238         call        HalfS
0104   2???           00239         call        HalfS
0105   2???           00240         call        HalfS
                      00241        
0106   2???           00242         call        HalfS
0107   2???           00243         call        HalfS
0108   2???           00244         call        HalfS
0109   2???           00245         call        HalfS
010A   2???           00246         call        HalfS
010B   2???           00247         call        HalfS
010C   2???           00248         call        HalfS
010D   2???           00249         call        HalfS
010E   2???           00250         call        HalfS
010F   2???           00251         call        HalfS
                      00252 
0110   2???           00253         call        HalfS
0111   2???           00254         call        HalfS
                      00255        
                      00256   
                      00257         ; Putting values in manually. This will be done automatically in main program
                      00258         movlf     B'00', status1
0112   3000               M         movlw   B'00'
0113   00B3               M         movwf   status1
                      00259         movlf     B'01', status2
0114   3001               M         movlw   B'01'
0115   00B4               M         movwf   status2
                      00260         movlf     B'10', status3
0116   3002               M         movlw   B'10'
0117   00B5               M         movwf   status3
                      00261         movlf     B'11', status4
0118   3003               M         movlw   B'11'
0119   00B6               M         movwf   status4
                      00262         movlf     B'01', status5
011A   3001               M         movlw   B'01'
011B   00B7               M         movwf   status5
                      00263         movlf     B'01', status6
011C   3001               M         movlw   B'01'
011D   00B8               M         movwf   status6
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00264         movlf     B'01', status7
011E   3001               M         movlw   B'01'
011F   00B9               M         movwf   status7
                      00265         movlf     B'11', status8
0120   3003               M         movlw   B'11'
0121   00BA               M         movwf   status8
                      00266         movlf     B'00', status9
0122   3000               M         movlw   B'00'
0123   00BB               M         movwf   status9
                      00267         movlf     D'3', num_def
0124   3003               M         movlw   D'3'
0125   00BC               M         movwf   num_def
                      00268         movlf     D'7', num_tot
0126   3007               M         movlw   D'7'
0127   00BD               M         movwf   num_tot
                      00269 
                      00270         ;stop the timer
0128   128B           00271          bcf         INTCON, T0IE ;disable Timer0 interrupt
                      00272 
                      00273         ; ending messages
0129   2???           00274         call       Clear_Display
                      00275         Display    End_Msg
  0000                    M                 local   loop_
  0000                    M                 local   end_
012A   01A2               M                 clrf    Table_Counter
012B   0103               M                 clrw
012C   0822               M loop_   movf    Table_Counter,W
012D   2???               M                 call    End_Msg
012E   3A00               M                 xorlw   B'00000000' ;check WORK reg to see if 0 is returned
012F   1903               M                 btfsc   STATUS,Z
0130   2???               M                 goto    end_
0131   2???               M                 call    WR_DATA
0132   0AA2               M                 incf    Table_Counter,F
0133   2???               M                 goto    loop_
0134                      M end_
0134   2???           00276         call       HalfS
0135   2???           00277         call       time
0136   2???           00278         call       HalfS
0137   2???           00279         call       HalfS
0138   2???           00280         call       summary
0139   2???           00281         call       HalfS
013A   2???           00282         call       HalfS
013B   2???           00283         call       defective
                      00284 ;-----------------------------------------------------------------------
                      00285 ; Data display interface
                      00286 
013C   1C86           00287 poll     btfss          PORTB,1     ;Wait until data is available from the keypad
013D   2???           00288          goto           $-1
                      00289 
013E   0E06           00290          swapf          PORTB,W     ;Read PortB<7:4> into W<3:0>
013F   390F           00291          andlw          0x0F
0140   2???           00292          call       information
                      00293 
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0141   1886           00294          btfsc          PORTB,1     ;Wait until key is released
0142   2???           00295          goto           $-1
0143   2???           00296          goto       poll
                      00297 
                      00298 ; END OF MAIN PROGRAM
                      00299 ;-------------------------------------------------------------------------
                      00300 
                      00301 
                      00302 
                      00303 ;***************************************
                      00304 ; DATA DISPLAY ROUTINE (written by me)
                      00305 ;***************************************
0144                  00306 information
0144   00A0           00307     movwf   keytemp             ; save value of W in msgtemp
                      00308 
0145                  00309 check_1
0145   3A00           00310     xorlw   0x0         ;will be all zeros if its 1
0146   1D03           00311     btfss   STATUS,Z    ;and Z will be high, so skip
0147   2???           00312     goto    check_2
0148   2???           00313     call    Clear_Display
                      00314     writenum 0x1
0149   3001               M             movlw    0x1
014A   3E30               M             addlw   B'00110000'
014B   00A4               M             movwf   dat
014C   2???               M             call WR_DATA
014D   0833           00315     movf    status1, W
014E   2???           00316     call    display_status
014F   0008           00317     return
                      00318 
0150                  00319 check_2
0150   0820           00320     movf    keytemp, W
0151   3A01           00321     xorlw   0x1
0152   1D03           00322     btfss   STATUS,Z
0153   2???           00323     goto    check_3
0154   2???           00324     call    Clear_Display
                      00325     writenum 0x2
0155   3002               M             movlw    0x2
0156   3E30               M             addlw   B'00110000'
0157   00A4               M             movwf   dat
0158   2???               M             call WR_DATA
0159   0834           00326     movf    status2, W
015A   2???           00327     call    display_status
015B   0008           00328     return
                      00329 
015C                  00330 check_3
015C   0820           00331     movf    keytemp, W
015D   3A02           00332     xorlw   0x2
015E   1D03           00333     btfss   STATUS,Z
015F   2???           00334     goto    check_4
0160   2???           00335     call    Clear_Display
                      00336     writenum 0x3
0161   3003               M             movlw    0x3
0162   3E30               M             addlw   B'00110000'
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0163   00A4               M             movwf   dat
0164   2???               M             call WR_DATA
0165   0835           00337     movf    status3, W
0166   2???           00338     call    display_status
0167   0008           00339     return
                      00340 
0168                  00341 check_4
0168   0820           00342     movf    keytemp, W
0169   3A04           00343     xorlw   0x4
016A   1D03           00344     btfss   STATUS,Z
016B   2???           00345     goto    check_5
016C   2???           00346     call    Clear_Display
                      00347     writenum 0x4
016D   3004               M             movlw    0x4
016E   3E30               M             addlw   B'00110000'
016F   00A4               M             movwf   dat
0170   2???               M             call WR_DATA
0171   0836           00348     movf    status4, W
0172   2???           00349     call    display_status
0173   0008           00350     return
                      00351 
0174                  00352 check_5
0174   0820           00353     movf    keytemp, W
0175   3A05           00354     xorlw   0x5
0176   1D03           00355     btfss   STATUS,Z
0177   2???           00356     goto    check_6
0178   2???           00357     call    Clear_Display
                      00358     writenum 0x5
0179   3005               M             movlw    0x5
017A   3E30               M             addlw   B'00110000'
017B   00A4               M             movwf   dat
017C   2???               M             call WR_DATA
017D   0837           00359     movf    status5, W
017E   2???           00360     call    display_status
017F   0008           00361     return
                      00362 
0180                  00363 check_6
0180   0820           00364     movf    keytemp, W
0181   3A06           00365     xorlw   0x6
0182   1D03           00366     btfss   STATUS,Z
0183   2???           00367     goto    check_7
0184   2???           00368     call    Clear_Display
                      00369     writenum 0x6
0185   3006               M             movlw    0x6
0186   3E30               M             addlw   B'00110000'
0187   00A4               M             movwf   dat
0188   2???               M             call WR_DATA
0189   0838           00370     movf    status6, W
018A   2???           00371     call    display_status
018B   0008           00372     return
                      00373 
018C                  00374 check_7
018C   0820           00375     movf    keytemp, W
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

018D   3A08           00376     xorlw   0x8
018E   1D03           00377     btfss   STATUS,Z
018F   2???           00378     goto    check_8
0190   2???           00379     call    Clear_Display
                      00380     writenum 0x7
0191   3007               M             movlw    0x7
0192   3E30               M             addlw   B'00110000'
0193   00A4               M             movwf   dat
0194   2???               M             call WR_DATA
0195   0839           00381     movf    status7, W
0196   2???           00382     call    display_status
0197   0008           00383     return
                      00384 
0198                  00385 check_8
0198   0820           00386     movf    keytemp, W
0199   3A09           00387     xorlw   0x9
019A   1D03           00388     btfss   STATUS,Z
019B   2???           00389     goto    check_9
019C   2???           00390     call    Clear_Display
                      00391     writenum 0x8
019D   3008               M             movlw    0x8
019E   3E30               M             addlw   B'00110000'
019F   00A4               M             movwf   dat
01A0   2???               M             call WR_DATA
01A1   083A           00392     movf    status8, W
01A2   2???           00393     call    display_status
01A3   0008           00394     return
                      00395 
01A4                  00396 check_9
01A4   0820           00397     movf    keytemp, W
01A5   3A0A           00398     xorlw   0xA
01A6   1D03           00399     btfss   STATUS,Z
01A7   2???           00400     goto    check_summary
01A8   2???           00401     call    Clear_Display
                      00402     writenum 0x9
01A9   3009               M             movlw    0x9
01AA   3E30               M             addlw   B'00110000'
01AB   00A4               M             movwf   dat
01AC   2???               M             call WR_DATA
01AD   083B           00403     movf    status9, W
01AE   2???           00404     call    display_status
01AF   0008           00405     return
                      00406 
01B0                  00407 check_summary
01B0   0820           00408     movf    keytemp, W
01B1   3A03           00409     xorlw   0x3
01B2   1D03           00410     btfss   STATUS,Z
01B3   2???           00411     goto    check_defective
01B4   2???           00412     call    summary
01B5   0008           00413     return
                      00414 
01B6                  00415 check_defective
01B6   0820           00416     movf    keytemp, W
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01B7   3A07           00417     xorlw   0x7
01B8   1D03           00418     btfss   STATUS,Z
01B9   2???           00419     goto    check_time
01BA   2???           00420     call    defective
01BB   0008           00421     return
                      00422 
01BC                  00423 check_time
01BC   0820           00424     movf    keytemp, W
01BD   3A0B           00425     xorlw   0xB
01BE   1D03           00426     btfss   STATUS,Z
01BF   2???           00427     goto    check_export
01C0   2???           00428     call    time
01C1   0008           00429     return
                      00430 
01C2                  00431 check_export                ;doesn't actually export yet
01C2   0820           00432     movf    keytemp, W
01C3   3A0F           00433     xorlw   0xF
01C4   1D03           00434     btfss   STATUS,Z
01C5   2???           00435     goto    check_start
01C6   2???           00436     call    export
01C7   0008           00437     return
                      00438 
01C8                  00439 check_start
01C8   0820           00440     movf    keytemp, W
01C9   3A0D           00441     xorlw   0xD
01CA   1D03           00442     btfss   STATUS,Z
01CB   2???           00443     goto    check_standby
01CC   2???           00444     goto    start
                      00445 
01CD                  00446 check_standby
01CD   0820           00447     movf    keytemp, W
01CE   3A0E           00448     xorlw   0xE
01CF   1D03           00449     btfss   STATUS,Z
01D0   2???           00450     goto    default_key
01D1   2???           00451     call    Clear_Display
                      00452     Display Standby_Msg
  0000                    M                 local   loop_
  0000                    M                 local   end_
01D2   01A2               M                 clrf    Table_Counter
01D3   0103               M                 clrw
01D4   0822               M loop_   movf    Table_Counter,W
01D5   2???               M                 call    Standby_Msg
01D6   3A00               M                 xorlw   B'00000000' ;check WORK reg to see if 0 is returned
01D7   1903               M                 btfsc   STATUS,Z
01D8   2???               M                 goto    end_
01D9   2???               M                 call    WR_DATA
01DA   0AA2               M                 incf    Table_Counter,F
01DB   2???               M                 goto    loop_
01DC                      M end_
01DC   2???           00453     goto    waiting
                      00454 
01DD                  00455 default_key
01DD   0008           00456     return
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00457 
                      00458 
                      00459 ;Display status subroutine
01DE                  00460 display_status
01DE   00A1           00461     movwf  statustemp
                      00462 
01DF                  00463 check_none
01DF   3A00           00464     xorlw   0x0
01E0   1D03           00465     btfss   STATUS,Z
01E1   2???           00466     goto    check_pass
                      00467     Display Not_present
  0000                    M                 local   loop_
  0000                    M                 local   end_
01E2   01A2               M                 clrf    Table_Counter
01E3   0103               M                 clrw
01E4   0822               M loop_   movf    Table_Counter,W
01E5   2???               M                 call    Not_present
01E6   3A00               M                 xorlw   B'00000000' ;check WORK reg to see if 0 is returned
01E7   1903               M                 btfsc   STATUS,Z
01E8   2???               M                 goto    end_
01E9   2???               M                 call    WR_DATA
01EA   0AA2               M                 incf    Table_Counter,F
01EB   2???               M                 goto    loop_
01EC                      M end_
01EC   0008           00468     return
                      00469 
01ED                  00470 check_pass
01ED   0821           00471     movf    statustemp, W
01EE   3A01           00472     xorlw   0x1
01EF   1D03           00473     btfss   STATUS,Z
01F0   2???           00474     goto    check_LED
                      00475     Display Pass
  0000                    M                 local   loop_
  0000                    M                 local   end_
01F1   01A2               M                 clrf    Table_Counter
01F2   0103               M                 clrw
01F3   0822               M loop_   movf    Table_Counter,W
01F4   2???               M                 call    Pass
01F5   3A00               M                 xorlw   B'00000000' ;check WORK reg to see if 0 is returned
01F6   1903               M                 btfsc   STATUS,Z
01F7   2???               M                 goto    end_
01F8   2???               M                 call    WR_DATA
01F9   0AA2               M                 incf    Table_Counter,F
01FA   2???               M                 goto    loop_
01FB                      M end_
01FB   0008           00476     return
                      00477 
01FC                  00478 check_LED
01FC   0821           00479     movf    statustemp, W
01FD   3A02           00480     xorlw   0x2
01FE   1D03           00481     btfss   STATUS,Z
01FF   2???           00482     goto    check_flick
                      00483     Display LED_fail
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  0000                    M                 local   loop_
  0000                    M                 local   end_
0200   01A2               M                 clrf    Table_Counter
0201   0103               M                 clrw
0202   0822               M loop_   movf    Table_Counter,W
0203   2???               M                 call    LED_fail
0204   3A00               M                 xorlw   B'00000000' ;check WORK reg to see if 0 is returned
0205   1903               M                 btfsc   STATUS,Z
0206   2???               M                 goto    end_
0207   2???               M                 call    WR_DATA
0208   0AA2               M                 incf    Table_Counter,F
0209   2???               M                 goto    loop_
020A                      M end_
020A   0008           00484     return
                      00485 
020B                  00486 check_flick
020B   0821           00487     movf    statustemp, W
020C   3A03           00488     xorlw   0x3
020D   1D03           00489     btfss   STATUS,Z
020E   2???           00490     goto    default_status
                      00491     Display Flick_fail
  0000                    M                 local   loop_
  0000                    M                 local   end_
020F   01A2               M                 clrf    Table_Counter
0210   0103               M                 clrw
0211   0822               M loop_   movf    Table_Counter,W
0212   2???               M                 call    Flick_fail
0213   3A00               M                 xorlw   B'00000000' ;check WORK reg to see if 0 is returned
0214   1903               M                 btfsc   STATUS,Z
0215   2???               M                 goto    end_
0216   2???               M                 call    WR_DATA
0217   0AA2               M                 incf    Table_Counter,F
0218   2???               M                 goto    loop_
0219                      M end_
0219   0008           00492     return
                      00493 
021A                  00494 default_status
021A   0008           00495     return
                      00496 
                      00497 ; Summary Subroutine
021B                  00498 summary
021B   2???           00499     call            Clear_Display
                      00500     Display         Total_Msg
  0000                    M                 local   loop_
  0000                    M                 local   end_
021C   01A2               M                 clrf    Table_Counter
021D   0103               M                 clrw
021E   0822               M loop_   movf    Table_Counter,W
021F   2???               M                 call    Total_Msg
0220   3A00               M                 xorlw   B'00000000' ;check WORK reg to see if 0 is returned
0221   1903               M                 btfsc   STATUS,Z
0222   2???               M                 goto    end_
0223   2???               M                 call    WR_DATA
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0224   0AA2               M                 incf    Table_Counter,F
0225   2???               M                 goto    loop_
0226                      M end_
                      00501     writenum_reg    num_tot
0226   083D               M             movfw    num_tot
0227   3E30               M             addlw   B'00110000'
0228   00A4               M             movwf   dat
0229   2???               M             call WR_DATA
022A   2???           00502     call            Switch_Lines
                      00503     Display         Defective
  0000                    M                 local   loop_
  0000                    M                 local   end_
022B   01A2               M                 clrf    Table_Counter
022C   0103               M                 clrw
022D   0822               M loop_   movf    Table_Counter,W
022E   2???               M                 call    Defective
022F   3A00               M                 xorlw   B'00000000' ;check WORK reg to see if 0 is returned
0230   1903               M                 btfsc   STATUS,Z
0231   2???               M                 goto    end_
0232   2???               M                 call    WR_DATA
0233   0AA2               M                 incf    Table_Counter,F
0234   2???               M                 goto    loop_
0235                      M end_
                      00504     writenum_reg    num_def
0235   083C               M             movfw    num_def
0236   3E30               M             addlw   B'00110000'
0237   00A4               M             movwf   dat
0238   2???               M             call WR_DATA
0239   0008           00505     return
                      00506 
                      00507 ; Defective candles Subroutine
023A                  00508 defective
023A   2???           00509     call            Clear_Display
                      00510     Display         Defective
  0000                    M                 local   loop_
  0000                    M                 local   end_
023B   01A2               M                 clrf    Table_Counter
023C   0103               M                 clrw
023D   0822               M loop_   movf    Table_Counter,W
023E   2???               M                 call    Defective
023F   3A00               M                 xorlw   B'00000000' ;check WORK reg to see if 0 is returned
0240   1903               M                 btfsc   STATUS,Z
0241   2???               M                 goto    end_
0242   2???               M                 call    WR_DATA
0243   0AA2               M                 incf    Table_Counter,F
0244   2???               M                 goto    loop_
0245                      M end_
0245   2???           00511     call            Switch_Lines
0246   08BC           00512     movf            num_def, F
0247   1D03           00513     btfss           STATUS,Z         ;if none defective, just say "none"
0248   2???           00514     goto            one
                      00515     Display         None
  0000                    M                 local   loop_
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  0000                    M                 local   end_
0249   01A2               M                 clrf    Table_Counter
024A   0103               M                 clrw
024B   0822               M loop_   movf    Table_Counter,W
024C   2???               M                 call    None
024D   3A00               M                 xorlw   B'00000000' ;check WORK reg to see if 0 is returned
024E   1903               M                 btfsc   STATUS,Z
024F   2???               M                 goto    end_
0250   2???               M                 call    WR_DATA
0251   0AA2               M                 incf    Table_Counter,F
0252   2???               M                 goto    loop_
0253                      M end_
0253   0008           00516     return
0254                  00517 one
0254   1CB3           00518     btfss           status1, 1          ;defective if status is 10 or 11
0255   2???           00519     goto            two
                      00520     writenum        0x1
0256   3001               M             movlw    0x1
0257   3E30               M             addlw   B'00110000'
0258   00A4               M             movwf   dat
0259   2???               M             call WR_DATA
                      00521     spacebar
025A   3014               M             movlw   B'00010100'
025B   2???               M             call    WR_INS
025C                  00522 two
025C   1CB4           00523     btfss           status2, 1          ;defective if status is 10 or 11
025D   2???           00524     goto            three
                      00525     writenum        0x2
025E   3002               M             movlw    0x2
025F   3E30               M             addlw   B'00110000'
0260   00A4               M             movwf   dat
0261   2???               M             call WR_DATA
                      00526     spacebar
0262   3014               M             movlw   B'00010100'
0263   2???               M             call    WR_INS
0264                  00527 three
0264   1CB5           00528     btfss           status3, 1          ;defective if status is 10 or 11
0265   2???           00529     goto            four
                      00530     writenum        0x3
0266   3003               M             movlw    0x3
0267   3E30               M             addlw   B'00110000'
0268   00A4               M             movwf   dat
0269   2???               M             call WR_DATA
                      00531     spacebar
026A   3014               M             movlw   B'00010100'
026B   2???               M             call    WR_INS
026C                  00532 four
026C   1CB6           00533     btfss           status4, 1          ;defective if status is 10 or 11
026D   2???           00534     goto            five
                      00535     writenum        0x4
026E   3004               M             movlw    0x4
026F   3E30               M             addlw   B'00110000'
0270   00A4               M             movwf   dat
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0271   2???               M             call WR_DATA
                      00536     spacebar
0272   3014               M             movlw   B'00010100'
0273   2???               M             call    WR_INS
0274                  00537 five
0274   1CB7           00538     btfss           status5, 1          ;defective if status is 10 or 11
0275   2???           00539     goto            six
                      00540     writenum        0x5
0276   3005               M             movlw    0x5
0277   3E30               M             addlw   B'00110000'
0278   00A4               M             movwf   dat
0279   2???               M             call WR_DATA
                      00541     spacebar
027A   3014               M             movlw   B'00010100'
027B   2???               M             call    WR_INS
027C                  00542 six
027C   1CB8           00543     btfss           status6, 1          ;defective if status is 10 or 11
027D   2???           00544     goto            seven
                      00545     writenum        0x6
027E   3006               M             movlw    0x6
027F   3E30               M             addlw   B'00110000'
0280   00A4               M             movwf   dat
0281   2???               M             call WR_DATA
                      00546     spacebar
0282   3014               M             movlw   B'00010100'
0283   2???               M             call    WR_INS
0284                  00547 seven
0284   1CB9           00548     btfss           status7, 1          ;defective if status is 10 or 11
0285   2???           00549     goto            eight
                      00550     writenum        0x7
0286   3007               M             movlw    0x7
0287   3E30               M             addlw   B'00110000'
0288   00A4               M             movwf   dat
0289   2???               M             call WR_DATA
                      00551     spacebar
028A   3014               M             movlw   B'00010100'
028B   2???               M             call    WR_INS
028C                  00552 eight
028C   1CBA           00553     btfss           status8, 1          ;defective if status is 10 or 11
028D   2???           00554     goto            nine
                      00555     writenum        0x8
028E   3008               M             movlw    0x8
028F   3E30               M             addlw   B'00110000'
0290   00A4               M             movwf   dat
0291   2???               M             call WR_DATA
                      00556     spacebar
0292   3014               M             movlw   B'00010100'
0293   2???               M             call    WR_INS
0294                  00557 nine
0294   1CBB           00558     btfss           status9, 1          ;defective if status is 10 or 11
0295   2???           00559     goto            end_defective
                      00560     writenum        0x9
0296   3009               M             movlw    0x9
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0297   3E30               M             addlw   B'00110000'
0298   00A4               M             movwf   dat
0299   2???               M             call WR_DATA
029A                  00561 end_defective
029A   0008           00562     return
                      00563 
                      00564 ; Time subroutine
                      00565 ; Right now this takes the time in seconds as a binary number in op_time
                      00566 ; and puts it into huns,tens,ones to display. It assumes op_time was getting
                      00567 ; incremented every second. However I may just take the stop time - start time
                      00568 ; from the RTC data so this might change a lot.
029B                  00569 time
029B   2???           00570     call    Clear_Display
                      00571     Display Time_Msg
  0000                    M                 local   loop_
  0000                    M                 local   end_
029C   01A2               M                 clrf    Table_Counter
029D   0103               M                 clrw
029E   0822               M loop_   movf    Table_Counter,W
029F   2???               M                 call    Time_Msg
02A0   3A00               M                 xorlw   B'00000000' ;check WORK reg to see if 0 is returned
02A1   1903               M                 btfsc   STATUS,Z
02A2   2???               M                 goto    end_
02A3   2???               M                 call    WR_DATA
02A4   0AA2               M                 incf    Table_Counter,F
02A5   2???               M                 goto    loop_
02A6                      M end_
02A6   2???           00572     call    Switch_Lines
02A7   0832           00573     movf    op_time, W
02A8   2???           00574     call    big_number
02A9   082B           00575     movf    huns, W
02AA   1903           00576     btfsc   STATUS,Z        ;if huns is zero don't display it
02AB   2???           00577     goto    no_huns
                      00578     writenum_reg    huns
02AC   082B               M             movfw    huns
02AD   3E30               M             addlw   B'00110000'
02AE   00A4               M             movwf   dat
02AF   2???               M             call WR_DATA
02B0                  00579 no_huns
02B0   082C           00580     movf    tens, W
02B1   1903           00581     btfsc   STATUS,Z        ;if tens is zero don't display it
02B2   2???           00582     goto    no_tens
                      00583     writenum_reg    tens
02B3   082C               M             movfw    tens
02B4   3E30               M             addlw   B'00110000'
02B5   00A4               M             movwf   dat
02B6   2???               M             call WR_DATA
02B7                  00584 no_tens
                      00585     writenum_reg    ones
02B7   082D               M             movfw    ones
02B8   3E30               M             addlw   B'00110000'
02B9   00A4               M             movwf   dat
02BA   2???               M             call WR_DATA
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00586     Display Seconds
  0000                    M                 local   loop_
  0000                    M                 local   end_
02BB   01A2               M                 clrf    Table_Counter
02BC   0103               M                 clrw
02BD   0822               M loop_   movf    Table_Counter,W
02BE   2???               M                 call    Seconds
02BF   3A00               M                 xorlw   B'00000000' ;check WORK reg to see if 0 is returned
02C0   1903               M                 btfsc   STATUS,Z
02C1   2???               M                 goto    end_
02C2   2???               M                 call    WR_DATA
02C3   0AA2               M                 incf    Table_Counter,F
02C4   2???               M                 goto    loop_
02C5                      M end_
02C5   0008           00587     return
                      00588 
                      00589 ; Export subroutine         (DOESNT ACTUALLY EXPORT YET!)
02C6                  00590 export
02C6   2???           00591     call    Clear_Display
                      00592     Display Export_Msg
  0000                    M                 local   loop_
  0000                    M                 local   end_
02C7   01A2               M                 clrf    Table_Counter
02C8   0103               M                 clrw
02C9   0822               M loop_   movf    Table_Counter,W
02CA   2???               M                 call    Export_Msg
02CB   3A00               M                 xorlw   B'00000000' ;check WORK reg to see if 0 is returned
02CC   1903               M                 btfsc   STATUS,Z
02CD   2???               M                 goto    end_
02CE   2???               M                 call    WR_DATA
02CF   0AA2               M                 incf    Table_Counter,F
02D0   2???               M                 goto    loop_
02D1                      M end_
02D1   2???           00593     call    HalfS
02D2   2???           00594     call    HalfS
02D3   2???           00595     call    Clear_Display
                      00596     Display End_Msg
  0000                    M                 local   loop_
  0000                    M                 local   end_
02D4   01A2               M                 clrf    Table_Counter
02D5   0103               M                 clrw
02D6   0822               M loop_   movf    Table_Counter,W
02D7   2???               M                 call    End_Msg
02D8   3A00               M                 xorlw   B'00000000' ;check WORK reg to see if 0 is returned
02D9   1903               M                 btfsc   STATUS,Z
02DA   2???               M                 goto    end_
02DB   2???               M                 call    WR_DATA
02DC   0AA2               M                 incf    Table_Counter,F
02DD   2???               M                 goto    loop_
02DE                      M end_
02DE   0008           00597     return
                      00598 
                      00599 
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00600 ;***************************************
                      00601 ; DISPLAY BIG NUMBER ROUTINE
                      00602 ; modified from http://www.piclist.com/techref/microchip/math/radix/b2a-8b3d-ab.htm
                      00603 ; converts 8-bit binary number op_time to three BCDs representing huns, tens, ones
                      00604 ; uses "shift and add 3" algorithm
                      00605 ;***************************************
                      00606 
02DF                  00607 big_number
                      00608     movff   op_time, op_time_save         ;save the original op_time
02DF   0832               M         movf    op_time, W
02E0   00AA               M         movwf   op_time_save
                      00609     movlf   8, bignumcount                      ;will shift 8 times
02E1   3008               M         movlw   8
02E2   00AE               M         movwf   bignumcount
02E3   01AB           00610     clrf    huns
02E4   01AC           00611     clrf    tens
02E5   01AD           00612     clrf    ones
                      00613 
02E6                  00614 BCDadd3                             ; if any digit > 5, add3
02E6   3005           00615     movlw   0x5
02E7   022B           00616     subwf   huns, W
02E8   1803           00617     btfsc   STATUS, C
02E9   2???           00618     call    add3huns
                      00619 
02EA   3005           00620     movlw   0x5
02EB   022C           00621     subwf   tens, W
02EC   1803           00622     btfsc   STATUS, C
02ED   2???           00623     call    add3tens
                      00624 
02EE   3005           00625     movlw   0x5
02EF   022D           00626     subwf   ones, W
02F0   1803           00627     btfsc   STATUS, C
02F1   2???           00628     call    add3ones
                      00629 
02F2   03AE           00630     decf    bignumcount, 1
02F3   1003           00631     bcf     STATUS, C
02F4   0DB2           00632     rlf     op_time, 1              ; shift
02F5   0DAD           00633     rlf     ones, 1
02F6   1A2D           00634     btfsc   ones,4 ;
02F7   2???           00635     call    carryones               ; carry if too large
02F8   0DAC           00636     rlf     tens, 1
                      00637 
02F9   1A2C           00638     btfsc   tens,4 ;
02FA   2???           00639     call    carrytens
02FB   0DAB           00640     rlf     huns,1
02FC   1003           00641     bcf     STATUS, C
                      00642 
02FD   082E           00643     movf    bignumcount, W
02FE   1D03           00644     btfss   STATUS, Z
02FF   2???           00645     goto    BCDadd3                 ; repeat until you've shifted it 8 times
                      00646 
                      00647     movff    op_time_save, op_time     ;restore the original op_time
0300   082A               M         movf    op_time_save, W
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0301   00B2               M         movwf   op_time
0302   0008           00648     return
                      00649 
0303                  00650 add3huns
0303   3003           00651     movlw 0x3
0304   07AB           00652     addwf huns,F
0305   0008           00653     return
0306                  00654 add3tens
0306   3003           00655     movlw 0x3
0307   07AC           00656     addwf tens,F
0308   0008           00657     return
0309                  00658 add3ones
0309   3003           00659     movlw 0x3
030A   07AD           00660     addwf ones,F
030B   0008           00661     return
030C                  00662 carryones
030C   122D           00663     bcf ones, 4
030D   1403           00664     bsf STATUS, C
030E   0008           00665     return
030F                  00666 carrytens
030F   122C           00667     bcf tens, 4
0310   1403           00668     bsf STATUS, C
0311   0008           00669     return
                      00670 
                      00671 
                      00672 ;***************************************
                      00673 ; LCD ROUTINES (from sample code)
                      00674 ;***************************************
                      00675 
0312                  00676 InitLCD
0312   1283           00677         bcf STATUS,RP0
0313   1588           00678         bsf E     ;E default high
                      00679 
                      00680         ;Wait for LCD POR to finish (~15ms)
0314   2???           00681         call lcdLongDelay
0315   2???           00682         call lcdLongDelay
0316   2???           00683         call lcdLongDelay
                      00684 
                      00685         ;Ensure 8-bit mode first (no way to immediately guarantee 4-bit mode)
                      00686         ; -> Send b'0011' 3 times
0317   3033           00687         movlw   b'00110011'
0318   2???           00688         call    WR_INS
0319   2???           00689         call lcdLongDelay
031A   2???           00690         call lcdLongDelay
031B   3032           00691         movlw   b'00110010'
031C   2???           00692         call    WR_INS
031D   2???           00693         call lcdLongDelay
031E   2???           00694         call lcdLongDelay
                      00695 
                      00696         ; 4 bits, 2 lines, 5x7 dots
031F   3028           00697         movlw   b'00101000'
0320   2???           00698         call    WR_INS
0321   2???           00699         call lcdLongDelay
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0322   2???           00700         call lcdLongDelay
                      00701 
                      00702         ; display on/off
0323   300C           00703         movlw   b'00001100'
0324   2???           00704         call    WR_INS
0325   2???           00705         call lcdLongDelay
0326   2???           00706         call lcdLongDelay
                      00707 
                      00708         ; Entry mode
0327   3006           00709         movlw   b'00000110'
0328   2???           00710         call    WR_INS
0329   2???           00711         call lcdLongDelay
032A   2???           00712         call lcdLongDelay
                      00713 
                      00714         ; Clear ram
032B   3001           00715         movlw   b'00000001'
032C   2???           00716         call    WR_INS
032D   2???           00717         call lcdLongDelay
032E   2???           00718         call lcdLongDelay
032F   0008           00719         return
                      00720 
                      00721 
0330                  00722 Clear_Display
0330   3001           00723                 movlw   B'00000001'
0331   2???           00724                 call    WR_INS
0332   0008           00725                 return
                      00726 
0333                  00727 Switch_Lines
0333   30C0           00728                 movlw   B'11000000'
0334   2???           00729                 call    WR_INS
0335   0008           00730                 return
                      00731 
0336                  00732 WR_INS
0336   1108           00733         bcf             RS                              ;clear RS
0337   00A3           00734         movwf   com                             ;W --> com
0338   39F0           00735         andlw   0xF0                    ;mask 4 bits MSB w = X0
0339   0088           00736         movwf   PORTD                   ;Send 4 bits MSB
033A   1588           00737         bsf             E                               ;
033B   2???           00738         call    lcdLongDelay    ;__    __
033C   1188           00739         bcf             E                               ;  |__|
033D   0E23           00740         swapf   com,w
033E   39F0           00741         andlw   0xF0                    ;1111 0010
033F   0088           00742         movwf   PORTD                   ;send 4 bits LSB
0340   1588           00743         bsf             E                               ;
0341   2???           00744         call    lcdLongDelay    ;__    __
0342   1188           00745         bcf             E                               ;  |__|
0343   2???           00746         call    lcdLongDelay
0344   0008           00747         return
                      00748 
                      00749 
0345                  00750 WR_DATA
0345   1508           00751         bsf             RS
0346   00A4           00752         movwf   dat
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0347   0824           00753         movf    dat,w
0348   39F0           00754         andlw   0xF0
0349   3E04           00755         addlw   4
034A   0088           00756         movwf   PORTD
034B   1588           00757         bsf             E                               ;
034C   2???           00758         call    lcdLongDelay    ;__    __
034D   1188           00759         bcf             E                               ;  |__|
034E   0E24           00760         swapf   dat,w
034F   39F0           00761         andlw   0xF0
0350   3E04           00762         addlw   4
0351   0088           00763         movwf   PORTD
0352   1588           00764         bsf             E                               ;
0353   2???           00765         call    lcdLongDelay    ;__    __
0354   1188           00766         bcf             E                               ;  |__|
0355   0008           00767         return
                      00768 
0356                  00769 lcdLongDelay
0356   3014           00770     movlw d'20'
0357   00A6           00771     movwf lcd_d2
0358                  00772 LLD_LOOP
                      00773     LCD_DELAY
0358   30FF               M             movlw   0xFF
0359   00A5               M             movwf   lcd_d1
035A   0BA5               M             decfsz  lcd_d1,f
035B   2???               M             goto    $-1
035C   0BA6           00774     decfsz lcd_d2,f
035D   2???           00775     goto LLD_LOOP
035E   0008           00776     return
                      00777 
                      00778 
                      00779 
                      00780 ;***************************************
                      00781 ; DELAY 0.5S ROUTINE (from sample code)
                      00782 ;***************************************
035F                  00783 HalfS
  0000                00784         local   HalfS_0
035F   3088           00785       movlw 0x88
0360   00A7           00786       movwf COUNTH
0361   30BD           00787       movlw 0xBD
0362   00A8           00788       movwf COUNTM
0363   3003           00789       movlw 0x03
0364   00A9           00790       movwf COUNTL
                      00791 
0365                  00792 HalfS_0
0365   0BA7           00793       decfsz COUNTH, f
0366   2???           00794       goto   $+2
0367   0BA8           00795       decfsz COUNTM, f
0368   2???           00796       goto   $+2
0369   0BA9           00797       decfsz COUNTL, f
036A   2???           00798       goto   HalfS_0
                      00799 
036B   2???           00800       goto $+1
036C   0000           00801       nop
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

036D   0000           00802       nop
036E   0008           00803                 return
                      00804 
                      00805 
                      00806 
                      00807 ;***************************************
                      00808 ; ISR
                      00809 ; Currently only care about TMR0
                      00810 ;***************************************
036F                  00811 isr
036F   00B0           00812     movwf   w_isr           ;save W and status
0370   0E03           00813     swapf   STATUS, W
0371   1283           00814     bcf     STATUS, RP0
0372   00B1           00815     movwf   status_isr
                      00816 
Message[305]: Using default destination of 1 (file).
0373   0BAF           00817     decfsz    count76     ;if count76 gets to 76 it's been one second
0374   2???           00818     goto end_isr
                      00819     movlf   D'76', count76
0375   304C               M         movlw   D'76'
0376   00AF               M         movwf   count76
Message[305]: Using default destination of 1 (file).
0377   0AB2           00820     incf    op_time
                      00821 
0378                  00822 end_isr
0378   0E31           00823     swapf   status_isr, W   ;restore
0379   0083           00824     movwf   STATUS
037A   0EB0           00825     swapf   w_isr, F
037B   0E30           00826     swapf   w_isr, W
037C   110B           00827     bcf     INTCON, T0IF    ;clear the flag
037D   0009           00828     retfie
                      00829 
                      00830 
                      00831 
3F72                  00832     END
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 25


SYMBOL TABLE
  LABEL                             VALUE 

ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000006
ADCS1                             00000007
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
BCDadd3                           000002E6
BCLIE                             00000003
BCLIF                             00000003
BF                                00000000
BRGH                              00000002
C                                 00000000
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           0000001D
CCP2IE                            00000000
CCP2IF                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2X                             00000005
CCP2Y                             00000004
CCPR1                             00000015
CCPR1H                            00000016
CCPR1L                            00000015
CCPR2                             0000001B
CCPR2H                            0000001C
CCPR2L                            0000001B
CHS0                              00000003
CHS1                              00000004
CHS2                              00000005
CKE                               00000006
CKP                               00000004
COUNTH                            00000027
COUNTL                            00000029
COUNTM                            00000028
CREN                              00000004
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 26


SYMBOL TABLE
  LABEL                             VALUE 

CSRC                              00000007
Clear_Display                     00000330
D                                 00000005
DATA_ADDRESS                      00000005
DC                                00000001
D_A                               00000005
D_NOT_A                           00000005
Defective                         00000089
Display                           
E                                 PORTD,3
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
EECON2                            0000018D
EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
Emergency_Msg                     000000A2
End_Msg                           00000020
Export_Msg                        000000B2
F                                 00000001
FERR                              00000002
FSR                               00000004
Flick_fail                        00000068
GCEN                              00000007
GIE                               00000007
GO                                00000002
GO_DONE                           00000002
GO_NOT_DONE                       00000002
HalfS                             0000035F
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
IBF                               00000007
IBOV                              00000005
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
InitLCD                           00000312
LCD_DELAY                         
LED_fail                          0000005C
LLD_LOOP                          00000358
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000002
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 27


SYMBOL TABLE
  LABEL                             VALUE 

NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
None                              00000096
Not_present                       00000045
OBF                               00000006
OERR                              00000001
OPTION_REG                        00000081
P                                 00000004
PCFG0                             00000000
PCFG1                             00000001
PCFG2                             00000002
PCFG3                             00000003
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PEIE                              00000006
PEN                               00000002
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
PORTA                             00000005
PORTB                             00000006
PORTC                             00000007
PORTD                             00000008
PORTE                             00000009
PR2                               00000092
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PSPIE                             00000007
PSPIF                             00000007
PSPMODE                           00000004
Pass                              00000054
R                                 00000002
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 28


SYMBOL TABLE
  LABEL                             VALUE 

RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RC0                               00000000
RC1                               00000001
RC2                               00000002
RC3                               00000003
RC4                               00000004
RC5                               00000005
RC6                               00000006
RC7                               00000007
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
RCEN                              00000003
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
RD0                               00000000
RD1                               00000001
RD2                               00000002
RD3                               00000003
RD4                               00000004
RD5                               00000005
RD6                               00000006
RD7                               00000007
RE0                               00000000
RE1                               00000001
RE2                               00000002
READ_WRITE                        00000002
RP0                               00000005
RP1                               00000006
RS                                PORTD,2
RSEN                              00000001
RX9                               00000006
RX9D                              00000000
R_NOT_W                           00000002
R_W                               00000002
S                                 00000003
SEN                               00000000
SMP                               00000007
SPBRG                             00000099
SPEN                              00000007
SREN                              00000005
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPCON2                           00000091
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 29


SYMBOL TABLE
  LABEL                             VALUE 

SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000094
STATUS                            00000003
SYNC                              00000004
Seconds                           0000003B
Standby_Msg                       00000005
Start_Msg                         0000000E
Switch_Lines                      00000333
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1INSYNC                          00000002
T1OSCEN                           00000003
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1                              0000000E
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISA5                            00000005
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 30


SYMBOL TABLE
  LABEL                             VALUE 

TRISB                             00000086
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
TRISC                             00000087
TRISC0                            00000000
TRISC1                            00000001
TRISC2                            00000002
TRISC3                            00000003
TRISC4                            00000004
TRISC5                            00000005
TRISC6                            00000006
TRISC7                            00000007
TRISD                             00000088
TRISD0                            00000000
TRISD1                            00000001
TRISD2                            00000002
TRISD3                            00000003
TRISD4                            00000004
TRISD5                            00000005
TRISD6                            00000006
TRISD7                            00000007
TRISE                             00000089
TRISE0                            00000000
TRISE1                            00000001
TRISE2                            00000002
TRMT                              00000001
TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXD8                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
Table_Counter                     00000022
Time_Msg                          0000002A
Total_Msg                         00000078
UA                                00000001
W                                 00000000
WCOL                              00000007
WR                                00000001
WREN                              00000002
WRERR                             00000003
WR_DATA                           00000345
WR_INS                            00000336
Z                                 00000002
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 31


SYMBOL TABLE
  LABEL                             VALUE 

_.org_1_00DC                      000000DC
_.org_1_00E3                      000000E3
_.org_1_013D                      0000013D
_.org_1_0142                      00000142
_.org_1_035B                      0000035B
_.org_1_0366                      00000366
_.org_1_0368                      00000368
_.org_1_036B                      0000036B
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_BOREN_OFF                        00003FBF
_BOREN_ON                         00003FFF
_CONFIG                           00002007
_CPD_OFF                          00003FFF
_CPD_ON                           00003EFF
_CP_ALL                           00000FCF
_CP_HALF                          00001FDF
_CP_OFF                           00003FFF
_CP_UPPER_256                     00002FEF
_DEBUG_OFF                        00003FFF
_DEBUG_ON                         000037FF
_DEVID1                           00002006
_FOSC_EXTRC                       00003FFF
_FOSC_HS                          00003FFE
_FOSC_LP                          00003FFC
_FOSC_XT                          00003FFD
_HS_OSC                           00003FFE
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_LP_OSC                           00003FFC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDTE_OFF                         00003FFB
_WDTE_ON                          00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_WRT_ENABLE_OFF                   00003DFF
_WRT_ENABLE_ON                    00003FFF
_WRT_OFF                          00003DFF
_WRT_ON                           00003FFF
_XT_OSC                           00003FFD
__16F877                          00000001
add3huns                          00000303
add3ones                          00000309
add3tens                          00000306
big_number                        000002DF
bignumcount                       0000002E
carryones                         0000030C
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 32


SYMBOL TABLE
  LABEL                             VALUE 

carrytens                         0000030F
check_1                           00000145
check_2                           00000150
check_3                           0000015C
check_4                           00000168
check_5                           00000174
check_6                           00000180
check_7                           0000018C
check_8                           00000198
check_9                           000001A4
check_LED                         000001FC
check_defective                   000001B6
check_export                      000001C2
check_flick                       0000020B
check_none                        000001DF
check_pass                        000001ED
check_standby                     000001CD
check_start                       000001C8
check_summary                     000001B0
check_time                        000001BC
com                               00000023
count76                           0000002F
dat                               00000024
default_key                       000001DD
default_status                    0000021A
defective                         0000023A
display_status                    000001DE
eight                             0000028C
end_defective                     0000029A
end_isr                           00000378
export                            000002C6
five                              00000274
four                              0000026C
huns                              0000002B
information                       00000144
init                              000000C3
isr                               0000036F
keytemp                           00000020
lcdLongDelay                      00000356
lcd_d1                            00000025
lcd_d2                            00000026
movff                             
movlf                             
nine                              00000294
no_huns                           000002B0
no_tens                           000002B7
num_def                           0000003C
num_tot                           0000003D
one                               00000254
ones                              0000002D
op_time                           00000032
op_time_save                      0000002A
poll                              0000013C
MPASM 5.54             INTERFACE_W_TIMER.ASM   2-3-2014  21:38:49         PAGE 33


SYMBOL TABLE
  LABEL                             VALUE 

seven                             00000284
six                               0000027C
spacebar                          
start                             000000E5
status1                           00000033
status2                           00000034
status3                           00000035
status4                           00000036
status5                           00000037
status6                           00000038
status7                           00000039
status8                           0000003A
status9                           0000003B
status_isr                        00000031
statustemp                        00000021
summary                           0000021B
tens                              0000002C
three                             00000264
time                              0000029B
two                               0000025C
w_isr                             00000030
waiting                           000000DB
writenum                          
writenum_reg                      

Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     7 reported,     0 suppressed

